import test from '@interactjs/_dev/test/test';
import { ActionName } from '@interactjs/core/scope';
import * as helpers from '@interactjs/core/tests/_helpers';
import { extend } from '@interactjs/utils';
import pointerUtils from '@interactjs/utils/pointerUtils';
import drag from './drag';
test('drag action init', (t) => {
    const scope = helpers.mockScope();
    drag.install(scope);
    t.ok(scope.actions.names.includes(ActionName.Drag), '"drag" in actions.names');
    t.equal(scope.actions.methodDict.drag, 'draggable');
    t.equal(typeof scope.Interactable.prototype.draggable, 'function');
    t.end();
});
test('Interactable.draggable method', (t) => {
    const interactable = {
        options: {
            drag: {},
        },
        draggable: drag.draggable,
        setPerAction: () => { calledSetPerAction = true; },
        setOnEvents: () => { calledSetOnEvents = true; },
    };
    let calledSetPerAction = false;
    let calledSetOnEvents = false;
    t.equal(interactable.draggable(), interactable.options.drag, 'interactable.draggable() returns interactable.options.drag object');
    interactable.draggable(true);
    t.ok(interactable.options.drag.enabled, 'calling `interactable.draggable(true)` enables dragging');
    interactable.draggable(false);
    t.notOk(interactable.options.drag.enabled, 'calling `interactable.draggable(false)` disables dragging');
    interactable.draggable({});
    t.ok(interactable.options.drag.enabled, 'calling `interactable.draggable({})` enables dragging');
    t.ok(calledSetOnEvents, 'calling `interactable.draggable({})` calls this.setOnEvents');
    t.ok(calledSetPerAction, 'calling `interactable.draggable({})` calls this.setPerAction');
    interactable.draggable({ enabled: false });
    t.notOk(interactable.options.drag.enabled, 'calling `interactable.draggable({ enabled: false })` disables dragging');
    const axisSettings = {
        lockAxis: ['x', 'y', 'xy', 'start'],
        startAxis: ['x', 'y', 'xy'],
    };
    for (const axis in axisSettings) {
        for (const value of axisSettings[axis]) {
            const options = {};
            options[axis] = value;
            interactable.draggable(options);
            t.equal(interactable.options.drag[axis], value, '`' + axis + ': "' + value + '"` is set correctly');
            delete interactable.options.drag[axis];
        }
    }
    t.end();
});
test('drag axis', (t) => {
    const scope = helpers.mockScope();
    drag.install(scope);
    const interaction = scope.interactions.new({});
    const element = {};
    const interactable = {
        options: {
            drag: {},
        },
        target: element,
    };
    const iEvent = { page: {}, client: {}, delta: {}, type: 'dragmove' };
    const opposites = { x: 'y', y: 'x' };
    const eventCoords = {
        page: { x: -1, y: -2 },
        client: { x: -3, y: -4 },
        delta: { x: -5, y: -6 },
    };
    const coords = helpers.newCoordsSet();
    resetCoords();
    interaction.prepared = { name: 'drag', axis: 'xy' };
    interaction.interact = interactable;
    t.test('xy (any direction)', (tt) => {
        scope.interactions.signals.fire('before-action-move', { interaction });
        tt.deepEqual(interaction.coords.start, coords.start, 'coords.start is not modified');
        tt.deepEqual(interaction.coords.delta, coords.delta, 'coords.delta is not modified');
        scope.interactions.signals.fire('action-move', { iEvent, interaction });
        tt.deepEqual(iEvent.page, eventCoords.page, 'page coords are not modified');
        tt.deepEqual(iEvent.delta, eventCoords.delta, 'delta is not modified');
        tt.end();
    });
    for (const axis in opposites) {
        const opposite = opposites[axis];
        t.test(axis + '-axis', (tt) => {
            resetCoords();
            interaction.prepared.axis = axis;
            scope.interactions.signals.fire('action-move', { iEvent, interaction });
            tt.deepEqual(iEvent.delta, {
                [opposite]: 0,
                [axis]: eventCoords.delta[axis],
            }, `opposite axis (${opposite}) delta is 0; target axis (${axis}) delta is not modified`);
            tt.deepEqual(iEvent.page, {
                [opposite]: coords.start.page[opposite],
                [axis]: eventCoords.page[axis],
            }, `page.${opposite} is coords.start value`);
            tt.equal(iEvent.page[axis], eventCoords.page[axis], `page.${axis} is not modified`);
            tt.equal(iEvent.client[opposite], coords.start.client[opposite], `client.${opposite} is coords.start value`);
            tt.equal(iEvent.client[axis], eventCoords.client[axis], `client.${axis} is not modified`);
            tt.end();
        });
    }
    t.end();
    function resetCoords() {
        pointerUtils.copyCoords(iEvent, eventCoords);
        extend(iEvent.delta, eventCoords.delta);
        for (const prop in coords) {
            pointerUtils.copyCoords(interaction.coords[prop], coords[prop]);
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZy5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZHJhZy5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sSUFBSSxNQUFNLDRCQUE0QixDQUFBO0FBQzdDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQTtBQUNuRCxPQUFPLEtBQUssT0FBTyxNQUFNLGlDQUFpQyxDQUFBO0FBQzFELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQTtBQUMxQyxPQUFPLFlBQVksTUFBTSxnQ0FBZ0MsQ0FBQTtBQUN6RCxPQUFPLElBQUksTUFBTSxRQUFRLENBQUE7QUFFekIsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7SUFDN0IsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFBO0lBRWpDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7SUFFbkIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLHlCQUF5QixDQUFDLENBQUE7SUFDOUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUE7SUFDbkQsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLEtBQUssQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQTtJQUVsRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUE7QUFDVCxDQUFDLENBQUMsQ0FBQTtBQUVGLElBQUksQ0FBQywrQkFBK0IsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO0lBQzFDLE1BQU0sWUFBWSxHQUFHO1FBQ25CLE9BQU8sRUFBRTtZQUNQLElBQUksRUFBRSxFQUFFO1NBQ1Q7UUFDRCxTQUFT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QyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO1NBQ2hFO0lBQ0gsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHRlc3QgZnJvbSAnQGludGVyYWN0anMvX2Rldi90ZXN0L3Rlc3QnXG5pbXBvcnQgeyBBY3Rpb25OYW1lIH0gZnJvbSAnQGludGVyYWN0anMvY29yZS9zY29wZSdcbmltcG9ydCAqIGFzIGhlbHBlcnMgZnJvbSAnQGludGVyYWN0anMvY29yZS90ZXN0cy9faGVscGVycydcbmltcG9ydCB7IGV4dGVuZCB9IGZyb20gJ0BpbnRlcmFjdGpzL3V0aWxzJ1xuaW1wb3J0IHBvaW50ZXJVdGlscyBmcm9tICdAaW50ZXJhY3Rqcy91dGlscy9wb2ludGVyVXRpbHMnXG5pbXBvcnQgZHJhZyBmcm9tICcuL2RyYWcnXG5cbnRlc3QoJ2RyYWcgYWN0aW9uIGluaXQnLCAodCkgPT4ge1xuICBjb25zdCBzY29wZSA9IGhlbHBlcnMubW9ja1Njb3BlKClcblxuICBkcmFnLmluc3RhbGwoc2NvcGUpXG5cbiAgdC5vayhzY29wZS5hY3Rpb25zLm5hbWVzLmluY2x1ZGVzKEFjdGlvbk5hbWUuRHJhZyksICdcImRyYWdcIiBpbiBhY3Rpb25zLm5hbWVzJylcbiAgdC5lcXVhbChzY29wZS5hY3Rpb25zLm1ldGhvZERpY3QuZHJhZywgJ2RyYWdnYWJsZScpXG4gIHQuZXF1YWwodHlwZW9mIHNjb3BlLkludGVyYWN0YWJsZS5wcm90b3R5cGUuZHJhZ2dhYmxlLCAnZnVuY3Rpb24nKVxuXG4gIHQuZW5kKClcbn0pXG5cbnRlc3QoJ0ludGVyYWN0YWJsZS5kcmFnZ2FibGUgbWV0aG9kJywgKHQpID0+IHtcbiAgY29uc3QgaW50ZXJhY3RhYmxlID0ge1xuICAgIG9wdGlvbnM6IHtcbiAgICAgIGRyYWc6IHt9LFxuICAgIH0sXG4gICAgZHJhZ2dhYmxlOiBkcmFnLmRyYWdnYWJsZSxcbiAgICBzZXRQZXJBY3Rpb246ICgpID0+IHsgY2FsbGVkU2V0UGVyQWN0aW9uID0gdHJ1ZSB9LFxuICAgIHNldE9uRXZlbnRzOiAoKSA9PiB7IGNhbGxlZFNldE9uRXZlbnRzID0gdHJ1ZSB9LFxuICB9IGFzIHVua25vd24gYXMgSW50ZXJhY3QuSW50ZXJhY3RhYmxlXG4gIGxldCBjYWxsZWRTZXRQZXJBY3Rpb24gPSBmYWxzZVxuICBsZXQgY2FsbGVkU2V0T25FdmVudHMgPSBmYWxzZVxuXG4gIHQuZXF1YWwoaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSgpLCBpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnLFxuICAgICdpbnRlcmFjdGFibGUuZHJhZ2dhYmxlKCkgcmV0dXJucyBpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnIG9iamVjdCcpXG5cbiAgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSh0cnVlKVxuICB0Lm9rKGludGVyYWN0YWJsZS5vcHRpb25zLmRyYWcuZW5hYmxlZCxcbiAgICAnY2FsbGluZyBgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSh0cnVlKWAgZW5hYmxlcyBkcmFnZ2luZycpXG5cbiAgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZShmYWxzZSlcbiAgdC5ub3RPayhpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnLmVuYWJsZWQsXG4gICAgJ2NhbGxpbmcgYGludGVyYWN0YWJsZS5kcmFnZ2FibGUoZmFsc2UpYCBkaXNhYmxlcyBkcmFnZ2luZycpXG5cbiAgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSh7fSlcbiAgdC5vayhpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnLmVuYWJsZWQsXG4gICAgJ2NhbGxpbmcgYGludGVyYWN0YWJsZS5kcmFnZ2FibGUoe30pYCBlbmFibGVzIGRyYWdnaW5nJylcbiAgdC5vayhjYWxsZWRTZXRPbkV2ZW50cyxcbiAgICAnY2FsbGluZyBgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSh7fSlgIGNhbGxzIHRoaXMuc2V0T25FdmVudHMnKVxuICB0Lm9rKGNhbGxlZFNldFBlckFjdGlvbixcbiAgICAnY2FsbGluZyBgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZSh7fSlgIGNhbGxzIHRoaXMuc2V0UGVyQWN0aW9uJylcblxuICBpbnRlcmFjdGFibGUuZHJhZ2dhYmxlKHsgZW5hYmxlZDogZmFsc2UgfSlcbiAgdC5ub3RPayhpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnLmVuYWJsZWQsXG4gICAgJ2NhbGxpbmcgYGludGVyYWN0YWJsZS5kcmFnZ2FibGUoeyBlbmFibGVkOiBmYWxzZSB9KWAgZGlzYWJsZXMgZHJhZ2dpbmcnKVxuXG4gIGNvbnN0IGF4aXNTZXR0aW5ncyA9IHtcbiAgICBsb2NrQXhpczogWyd4JywgJ3knLCAneHknLCAnc3RhcnQnXSxcbiAgICBzdGFydEF4aXM6IFsneCcsICd5JywgJ3h5J10sXG4gIH1cblxuICBmb3IgKGNvbnN0IGF4aXMgaW4gYXhpc1NldHRpbmdzKSB7XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiBheGlzU2V0dGluZ3NbYXhpc10pIHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7fVxuXG4gICAgICBvcHRpb25zW2F4aXNdID0gdmFsdWVcblxuICAgICAgaW50ZXJhY3RhYmxlLmRyYWdnYWJsZShvcHRpb25zKVxuICAgICAgdC5lcXVhbChpbnRlcmFjdGFibGUub3B0aW9ucy5kcmFnW2F4aXNdLCB2YWx1ZSxcbiAgICAgICAgJ2AnICsgYXhpcyArICc6IFwiJyArIHZhbHVlICsgJ1wiYCBpcyBzZXQgY29ycmVjdGx5JylcblxuICAgICAgZGVsZXRlIGludGVyYWN0YWJsZS5vcHRpb25zLmRyYWdbYXhpc11cbiAgICB9XG4gIH1cblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdkcmFnIGF4aXMnLCAodCkgPT4ge1xuICBjb25zdCBzY29wZSA9IGhlbHBlcnMubW9ja1Njb3BlKClcblxuICBkcmFnLmluc3RhbGwoc2NvcGUpXG5cbiAgY29uc3QgaW50ZXJhY3Rpb24gPSBzY29wZS5pbnRlcmFjdGlvbnMubmV3KHt9KVxuICBjb25zdCBlbGVtZW50ID0ge31cbiAgY29uc3QgaW50ZXJhY3RhYmxlID0ge1xuICAgIG9wdGlvbnM6IHtcbiAgICAgIGRyYWc6IHt9LFxuICAgIH0sXG4gICAgdGFyZ2V0OiBlbGVtZW50LFxuICB9IGFzIEludGVyYWN0LkludGVyYWN0YWJsZVxuICBjb25zdCBpRXZlbnQgPSB7IHBhZ2U6IHt9LCBjbGllbnQ6IHt9LCBkZWx0YToge30sIHR5cGU6ICdkcmFnbW92ZScgfSBhcyBJbnRlcmFjdC5JbnRlcmFjdEV2ZW50XG5cbiAgY29uc3Qgb3Bwb3NpdGVzID0geyB4OiAneScsIHk6ICd4JyB9XG4gIGNvbnN0IGV2ZW50Q29vcmRzID0ge1xuICAgIHBhZ2U6IHsgeDogLTEsIHk6IC0yIH0sXG4gICAgY2xpZW50OiB7IHg6IC0zLCB5OiAtNCB9LFxuICAgIGRlbHRhOiB7IHg6IC01LCB5OiAtNiB9LFxuICB9XG4gIGNvbnN0IGNvb3JkcyA9IGhlbHBlcnMubmV3Q29vcmRzU2V0KClcblxuICByZXNldENvb3JkcygpXG4gIGludGVyYWN0aW9uLnByZXBhcmVkID0geyBuYW1lOiAnZHJhZycsIGF4aXM6ICd4eScgfVxuICBpbnRlcmFjdGlvbi5pbnRlcmFjdCA9IGludGVyYWN0YWJsZVxuXG4gIHQudGVzdCgneHkgKGFueSBkaXJlY3Rpb24pJywgKHR0KSA9PiB7XG4gICAgc2NvcGUuaW50ZXJhY3Rpb25zLnNpZ25hbHMuZmlyZSgnYmVmb3JlLWFjdGlvbi1tb3ZlJywgeyBpbnRlcmFjdGlvbiB9KVxuXG4gICAgdHQuZGVlcEVxdWFsKGludGVyYWN0aW9uLmNvb3Jkcy5zdGFydCwgY29vcmRzLnN0YXJ0LFxuICAgICAgJ2Nvb3Jkcy5zdGFydCBpcyBub3QgbW9kaWZpZWQnKVxuICAgIHR0LmRlZXBFcXVhbChpbnRlcmFjdGlvbi5jb29yZHMuZGVsdGEsIGNvb3Jkcy5kZWx0YSxcbiAgICAgICdjb29yZHMuZGVsdGEgaXMgbm90IG1vZGlmaWVkJylcblxuICAgIHNjb3BlLmludGVyYWN0aW9ucy5zaWduYWxzLmZpcmUoJ2FjdGlvbi1tb3ZlJywgeyBpRXZlbnQsIGludGVyYWN0aW9uIH0pXG5cbiAgICB0dC5kZWVwRXF1YWwoaUV2ZW50LnBhZ2UsIGV2ZW50Q29vcmRzLnBhZ2UsICdwYWdlIGNvb3JkcyBhcmUgbm90IG1vZGlmaWVkJylcbiAgICB0dC5kZWVwRXF1YWwoaUV2ZW50LmRlbHRhLCBldmVudENvb3Jkcy5kZWx0YSwgJ2RlbHRhIGlzIG5vdCBtb2RpZmllZCcpXG5cbiAgICB0dC5lbmQoKVxuICB9KVxuXG4gIGZvciAoY29uc3QgYXhpcyBpbiBvcHBvc2l0ZXMpIHtcbiAgICBjb25zdCBvcHBvc2l0ZSA9IG9wcG9zaXRlc1theGlzXVxuXG4gICAgdC50ZXN0KGF4aXMgKyAnLWF4aXMnLCAodHQpID0+IHtcbiAgICAgIHJlc2V0Q29vcmRzKClcbiAgICAgIGludGVyYWN0aW9uLnByZXBhcmVkLmF4aXMgPSBheGlzIGFzIGFueVxuXG4gICAgICBzY29wZS5pbnRlcmFjdGlvbnMuc2lnbmFscy5maXJlKCdhY3Rpb24tbW92ZScsIHsgaUV2ZW50LCBpbnRlcmFjdGlvbiB9KVxuXG4gICAgICB0dC5kZWVwRXF1YWwoXG4gICAgICAgIGlFdmVudC5kZWx0YSxcbiAgICAgICAge1xuICAgICAgICAgIFtvcHBvc2l0ZV06IDAsXG4gICAgICAgICAgW2F4aXNdOiBldmVudENvb3Jkcy5kZWx0YVtheGlzXSxcbiAgICAgICAgfSxcbiAgICAgICAgYG9wcG9zaXRlIGF4aXMgKCR7b3Bwb3NpdGV9KSBkZWx0YSBpcyAwOyB0YXJnZXQgYXhpcyAoJHtheGlzfSkgZGVsdGEgaXMgbm90IG1vZGlmaWVkYClcblxuICAgICAgdHQuZGVlcEVxdWFsKFxuICAgICAgICBpRXZlbnQucGFnZSxcbiAgICAgICAge1xuICAgICAgICAgIFtvcHBvc2l0ZV06IGNvb3Jkcy5zdGFydC5wYWdlW29wcG9zaXRlXSxcbiAgICAgICAgICBbYXhpc106IGV2ZW50Q29vcmRzLnBhZ2VbYXhpc10sXG4gICAgICAgIH0sXG4gICAgICAgIGBwYWdlLiR7b3Bwb3NpdGV9IGlzIGNvb3Jkcy5zdGFydCB2YWx1ZWBcbiAgICAgIClcblxuICAgICAgdHQuZXF1YWwoXG4gICAgICAgIGlFdmVudC5wYWdlW2F4aXNdLFxuICAgICAgICBldmVudENvb3Jkcy5wYWdlW2F4aXNdLFxuICAgICAgICBgcGFnZS4ke2F4aXN9IGlzIG5vdCBtb2RpZmllZGBcbiAgICAgIClcblxuICAgICAgdHQuZXF1YWwoXG4gICAgICAgIGlFdmVudC5jbGllbnRbb3Bwb3NpdGVdLFxuICAgICAgICBjb29yZHMuc3RhcnQuY2xpZW50W29wcG9zaXRlXSxcbiAgICAgICAgYGNsaWVudC4ke29wcG9zaXRlfSBpcyBjb29yZHMuc3RhcnQgdmFsdWVgXG4gICAgICApXG4gICAgICB0dC5lcXVhbChcbiAgICAgICAgaUV2ZW50LmNsaWVudFtheGlzXSxcbiAgICAgICAgZXZlbnRDb29yZHMuY2xpZW50W2F4aXNdLFxuICAgICAgICBgY2xpZW50LiR7YXhpc30gaXMgbm90IG1vZGlmaWVkYFxuICAgICAgKVxuXG4gICAgICB0dC5lbmQoKVxuICAgIH0pXG4gIH1cblxuICB0LmVuZCgpXG5cbiAgZnVuY3Rpb24gcmVzZXRDb29yZHMgKCkge1xuICAgIHBvaW50ZXJVdGlscy5jb3B5Q29vcmRzKGlFdmVudCwgZXZlbnRDb29yZHMpXG4gICAgZXh0ZW5kKGlFdmVudC5kZWx0YSwgZXZlbnRDb29yZHMuZGVsdGEpXG5cbiAgICBmb3IgKGNvbnN0IHByb3AgaW4gY29vcmRzKSB7XG4gICAgICBwb2ludGVyVXRpbHMuY29weUNvb3JkcyhpbnRlcmFjdGlvbi5jb29yZHNbcHJvcF0sIGNvb3Jkc1twcm9wXSlcbiAgICB9XG4gIH1cbn0pXG4iXX0=