import d from '@interactjs/_dev/test/domator';
import test from '@interactjs/_dev/test/test';
import * as helpers from './helpers';
test('Interactable copies and extends defaults', (t) => {
    const scope = helpers.mockScope();
    const { defaults } = scope;
    scope.actions.methodDict = { test: 'testize' };
    scope.Interactable.prototype.testize = function (options) {
        this.setPerAction('test', options);
    };
    defaults.actions.test = {
        fromDefault: { a: 1, b: 2 },
        specified: { c: 1, d: 2 },
    };
    const specified = { specified: 'parent' };
    const div = d('div');
    const interactable = scope.interactables.new(div, { test: specified });
    t.deepEqual(interactable.options.test.specified, specified.specified, 'specified options are properly set');
    t.deepEqual(interactable.options.test.fromDefault, defaults.actions.test.fromDefault, 'default options are properly set');
    t.notEqual(interactable.options.test.fromDefault, defaults.actions.test.fromDefault, 'defaults are not aliased');
    defaults.actions.test.fromDefault.c = 3;
    t.notOk('c' in interactable.options.test.fromDefault, 'modifying defaults does not affect constructed interactables');
    t.end();
});
test('Interactable copies and extends per action defaults', (t) => {
    const scope = helpers.mockScope();
    const { defaults } = scope;
    scope.actions.methodDict = { test: 'testize' };
    scope.Interactable.prototype.testize = function (options) {
        this.setPerAction('test', options);
    };
    defaults.perAction.testModifier = {
        fromDefault: { a: 1, b: 2 },
        specified: null,
    };
    defaults.actions.test = { testModifier: defaults.perAction.testModifier };
    const div = d('div');
    const interactable = scope.interactables.new(div, {});
    interactable.testize({ testModifier: { specified: 'parent' } });
    t.deepEqual(interactable.options.test, {
        enabled: false,
        origin: { x: 0, y: 0 },
        testModifier: {
            fromDefault: { a: 1, b: 2 },
            specified: 'parent',
        },
    }, 'specified options are properly set');
    t.deepEqual(interactable.options.test.testModifier.fromDefault, defaults.perAction.testModifier.fromDefault, 'default options are properly set');
    t.notEqual(interactable.options.test.testModifier.fromDefault, defaults.perAction.testModifier.fromDefault, 'defaults are not aliased');
    defaults.perAction.testModifier.fromDefault.c = 3;
    t.notOk('c' in interactable.options.test.testModifier.fromDefault, 'modifying defaults does not affect constructed interactables');
    t.end();
});
test('Interactable.updatePerActionListeners', (t) => {
    const scope = helpers.mockScope();
    let fired = [];
    function addToFired(event) { fired.push(event); }
    scope.actions.eventTypes.push('teststart', 'testmove', 'testend');
    scope.actions.methodDict = { test: 'testize' };
    scope.Interactable.prototype.testize = function (options) {
        this.setPerAction('test', options);
    };
    scope.defaults.actions.test = {};
    const interactable = scope.interactables.new('target');
    interactable.setPerAction('test', {
        listeners: [{
                start: addToFired,
                move: addToFired,
                end: addToFired,
            }],
    });
    interactable.fire({ type: 'teststart' });
    t.deepEqual(fired.map((e) => e.type), ['teststart']);
    interactable.fire({ type: 'testmove' });
    t.deepEqual(fired.map((e) => e.type), ['teststart', 'testmove']);
    interactable.fire({ type: 'testnotadded' });
    t.deepEqual(fired.map((e) => e.type), ['teststart', 'testmove']);
    interactable.fire({ type: 'testend' });
    t.deepEqual(fired.map((e) => e.type), ['teststart', 'testmove', 'testend']);
    fired = [];
    interactable.setPerAction('test', {
        listeners: [{ start: addToFired }],
    });
    interactable.fire({ type: 'teststart' });
    interactable.fire({ type: 'testmove' });
    interactable.fire({ type: 'testend' });
    t.deepEqual(fired.map((e) => e.type), ['teststart']);
    fired = [];
    interactable.setPerAction('test', {
        listeners: null,
    });
    interactable.fire({ type: 'teststart' });
    interactable.fire({ type: 'testmove' });
    interactable.fire({ type: 'testend' });
    t.deepEqual(fired, []);
    t.end();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJhY3RhYmxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiSW50ZXJhY3RhYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sQ0FBQyxNQUFNLCtCQUErQixDQUFBO0FBQzdDLE9BQU8sSUFBSSxNQUFNLDRCQUE0QixDQUFBO0FBQzdDLE9BQU8sS0FBSyxPQUFPLE1BQU0sV0FBVyxDQUFBO0FBRXBDLElBQUksQ0FBQywwQ0FBMEMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO0lBQ3JELE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxTQUFTLEVBQVMsQ0FBQTtJQUN4QyxNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsS0FBSyxDQUFBO0lBRTFCLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxHQUFHLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFBO0lBRTlDLEtBQUssQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxVQUFVLE9BQU87UUFDdEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUE7SUFDcEMsQ0FBQyxDQUFBO0lBRUQsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUc7UUFDdEIsV0FBVyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFO1FBQzNCLFNBQVMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtLQUMxQixDQUFBO0lBRUQsTUFBTSxTQUFTLEdBQUcsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLENBQUE7SUFFekMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQ3BCLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFBO0lBRXRFLENB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QVksQ0FBQyxNQUFNLEVBQUU7UUFDaEMsU0FBUyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLENBQUM7S0FDbkMsQ0FBQyxDQUFBO0lBRUYsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFBO0lBQ3hDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQTtJQUN2QyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUE7SUFDdEMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFBO0lBRXBELEtBQUssR0FBRyxFQUFFLENBQUE7SUFDVixZQUFZLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRTtRQUNoQyxTQUFTLEVBQUUsSUFBSTtLQUNoQixDQUFDLENBQUE7SUFFRixZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUE7SUFDeEMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFBO0lBQ3ZDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQTtJQUN0QyxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQTtJQUV0QixDQUFDLENBQUMsR0FBRyxFQUFFLENBQUE7QUFDVCxDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkIGZyb20gJ0BpbnRlcmFjdGpzL19kZXYvdGVzdC9kb21hdG9yJ1xuaW1wb3J0IHRlc3QgZnJvbSAnQGludGVyYWN0anMvX2Rldi90ZXN0L3Rlc3QnXG5pbXBvcnQgKiBhcyBoZWxwZXJzIGZyb20gJy4vaGVscGVycydcblxudGVzdCgnSW50ZXJhY3RhYmxlIGNvcGllcyBhbmQgZXh0ZW5kcyBkZWZhdWx0cycsICh0KSA9PiB7XG4gIGNvbnN0IHNjb3BlID0gaGVscGVycy5tb2NrU2NvcGUoKSBhcyBhbnlcbiAgY29uc3QgeyBkZWZhdWx0cyB9ID0gc2NvcGVcblxuICBzY29wZS5hY3Rpb25zLm1ldGhvZERpY3QgPSB7IHRlc3Q6ICd0ZXN0aXplJyB9XG5cbiAgc2NvcGUuSW50ZXJhY3RhYmxlLnByb3RvdHlwZS50ZXN0aXplID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB0aGlzLnNldFBlckFjdGlvbigndGVzdCcsIG9wdGlvbnMpXG4gIH1cblxuICBkZWZhdWx0cy5hY3Rpb25zLnRlc3QgPSB7XG4gICAgZnJvbURlZmF1bHQ6IHsgYTogMSwgYjogMiB9LFxuICAgIHNwZWNpZmllZDogeyBjOiAxLCBkOiAyIH0sXG4gIH1cblxuICBjb25zdCBzcGVjaWZpZWQgPSB7IHNwZWNpZmllZDogJ3BhcmVudCcgfVxuXG4gIGNvbnN0IGRpdiA9IGQoJ2RpdicpXG4gIGNvbnN0IGludGVyYWN0YWJsZSA9IHNjb3BlLmludGVyYWN0YWJsZXMubmV3KGRpdiwgeyB0ZXN0OiBzcGVjaWZpZWQgfSlcblxuICB0LmRlZXBFcXVhbChpbnRlcmFjdGFibGUub3B0aW9ucy50ZXN0LnNwZWNpZmllZCwgc3BlY2lmaWVkLnNwZWNpZmllZCxcbiAgICAnc3BlY2lmaWVkIG9wdGlvbnMgYXJlIHByb3Blcmx5IHNldCcpXG4gIHQuZGVlcEVxdWFsKGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QuZnJvbURlZmF1bHQsIGRlZmF1bHRzLmFjdGlvbnMudGVzdC5mcm9tRGVmYXVsdCxcbiAgICAnZGVmYXVsdCBvcHRpb25zIGFyZSBwcm9wZXJseSBzZXQnKVxuICB0Lm5vdEVxdWFsKGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QuZnJvbURlZmF1bHQsIGRlZmF1bHRzLmFjdGlvbnMudGVzdC5mcm9tRGVmYXVsdCxcbiAgICAnZGVmYXVsdHMgYXJlIG5vdCBhbGlhc2VkJylcblxuICBkZWZhdWx0cy5hY3Rpb25zLnRlc3QuZnJvbURlZmF1bHQuYyA9IDNcbiAgdC5ub3RPaygnYycgaW4gaW50ZXJhY3RhYmxlLm9wdGlvbnMudGVzdC5mcm9tRGVmYXVsdCxcbiAgICAnbW9kaWZ5aW5nIGRlZmF1bHRzIGRvZXMgbm90IGFmZmVjdCBjb25zdHJ1Y3RlZCBpbnRlcmFjdGFibGVzJylcblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdJbnRlcmFjdGFibGUgY29waWVzIGFuZCBleHRlbmRzIHBlciBhY3Rpb24gZGVmYXVsdHMnLCAodCkgPT4ge1xuICBjb25zdCBzY29wZSA9IGhlbHBlcnMubW9ja1Njb3BlKClcbiAgY29uc3QgeyBkZWZhdWx0cyB9ID0gc2NvcGVcblxuICBzY29wZS5hY3Rpb25zLm1ldGhvZERpY3QgPSB7IHRlc3Q6ICd0ZXN0aXplJyB9XG5cbiAgc2NvcGUuSW50ZXJhY3RhYmxlLnByb3RvdHlwZS50ZXN0aXplID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB0aGlzLnNldFBlckFjdGlvbigndGVzdCcsIG9wdGlvbnMpXG4gIH1cblxuICBkZWZhdWx0cy5wZXJBY3Rpb24udGVzdE1vZGlmaWVyID0ge1xuICAgIGZyb21EZWZhdWx0OiB7IGE6IDEsIGI6IDIgfSxcbiAgICBzcGVjaWZpZWQ6IG51bGwsXG4gIH1cbiAgZGVmYXVsdHMuYWN0aW9ucy50ZXN0ID0geyB0ZXN0TW9kaWZpZXI6IGRlZmF1bHRzLnBlckFjdGlvbi50ZXN0TW9kaWZpZXIgfVxuXG4gIGNvbnN0IGRpdiA9IGQoJ2RpdicpXG4gIGNvbnN0IGludGVyYWN0YWJsZSA9IHNjb3BlLmludGVyYWN0YWJsZXMubmV3KGRpdiwge30pXG4gIGludGVyYWN0YWJsZS50ZXN0aXplKHsgdGVzdE1vZGlmaWVyOiB7IHNwZWNpZmllZDogJ3BhcmVudCcgfSB9KVxuXG4gIHQuZGVlcEVxdWFsKGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QsIHtcbiAgICBlbmFibGVkOiBmYWxzZSxcbiAgICBvcmlnaW46IHsgeDogMCwgeTogMCB9LFxuXG4gICAgdGVzdE1vZGlmaWVyOiB7XG4gICAgICBmcm9tRGVmYXVsdDogeyBhOiAxLCBiOiAyIH0sXG4gICAgICBzcGVjaWZpZWQ6ICdwYXJlbnQnLFxuICAgIH0sXG4gIH0sICdzcGVjaWZpZWQgb3B0aW9ucyBhcmUgcHJvcGVybHkgc2V0JylcbiAgdC5kZWVwRXF1YWwoXG4gICAgaW50ZXJhY3RhYmxlLm9wdGlvbnMudGVzdC50ZXN0TW9kaWZpZXIuZnJvbURlZmF1bHQsXG4gICAgZGVmYXVsdHMucGVyQWN0aW9uLnRlc3RNb2RpZmllci5mcm9tRGVmYXVsdCxcbiAgICAnZGVmYXVsdCBvcHRpb25zIGFyZSBwcm9wZXJseSBzZXQnKVxuICB0Lm5vdEVxdWFsKFxuICAgIGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QudGVzdE1vZGlmaWVyLmZyb21EZWZhdWx0LFxuICAgIGRlZmF1bHRzLnBlckFjdGlvbi50ZXN0TW9kaWZpZXIuZnJvbURlZmF1bHQsXG4gICAgJ2RlZmF1bHRzIGFyZSBub3QgYWxpYXNlZCcpXG5cbiAgZGVmYXVsdHMucGVyQWN0aW9uLnRlc3RNb2RpZmllci5mcm9tRGVmYXVsdC5jID0gM1xuICB0Lm5vdE9rKCdjJyBpbiBpbnRlcmFjdGFibGUub3B0aW9ucy50ZXN0LnRlc3RNb2RpZmllci5mcm9tRGVmYXVsdCxcbiAgICAnbW9kaWZ5aW5nIGRlZmF1bHRzIGRvZXMgbm90IGFmZmVjdCBjb25zdHJ1Y3RlZCBpbnRlcmFjdGFibGVzJylcblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdJbnRlcmFjdGFibGUudXBkYXRlUGVyQWN0aW9uTGlzdGVuZXJzJywgKHQpID0+IHtcbiAgY29uc3Qgc2NvcGUgPSBoZWxwZXJzLm1vY2tTY29wZSgpXG5cbiAgbGV0IGZpcmVkID0gW11cbiAgZnVuY3Rpb24gYWRkVG9GaXJlZCAoZXZlbnQpIHsgZmlyZWQucHVzaChldmVudCkgfVxuXG4gIHNjb3BlLmFjdGlvbnMuZXZlbnRUeXBlcy5wdXNoKCd0ZXN0c3RhcnQnLCAndGVzdG1vdmUnLCAndGVzdGVuZCcpXG4gIHNjb3BlLmFjdGlvbnMubWV0aG9kRGljdCA9IHsgdGVzdDogJ3Rlc3RpemUnIH1cbiAgc2NvcGUuSW50ZXJhY3RhYmxlLnByb3RvdHlwZS50ZXN0aXplID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB0aGlzLnNldFBlckFjdGlvbigndGVzdCcsIG9wdGlvbnMpXG4gIH1cblxuICBzY29wZS5kZWZhdWx0cy5hY3Rpb25zLnRlc3QgPSB7fVxuXG4gIGNvbnN0IGludGVyYWN0YWJsZSA9IHNjb3BlLmludGVyYWN0YWJsZXMubmV3KCd0YXJnZXQnKVxuXG4gIGludGVyYWN0YWJsZS5zZXRQZXJBY3Rpb24oJ3Rlc3QnLCB7XG4gICAgbGlzdGVuZXJzOiBbe1xuICAgICAgc3RhcnQ6IGFkZFRvRmlyZWQsXG4gICAgICBtb3ZlOiBhZGRUb0ZpcmVkLFxuICAgICAgZW5kOiBhZGRUb0ZpcmVkLFxuICAgIH1dLFxuICB9KVxuXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3RzdGFydCcgfSlcbiAgdC5kZWVwRXF1YWwoZmlyZWQubWFwKChlKSA9PiBlLnR5cGUpLCBbJ3Rlc3RzdGFydCddKVxuXG4gIGludGVyYWN0YWJsZS5maXJlKHsgdHlwZTogJ3Rlc3Rtb3ZlJyB9KVxuICB0LmRlZXBFcXVhbChmaXJlZC5tYXAoKGUpID0+IGUudHlwZSksIFsndGVzdHN0YXJ0JywgJ3Rlc3Rtb3ZlJ10pXG5cbiAgaW50ZXJhY3RhYmxlLmZpcmUoeyB0eXBlOiAndGVzdG5vdGFkZGVkJyB9KVxuICB0LmRlZXBFcXVhbChmaXJlZC5tYXAoKGUpID0+IGUudHlwZSksIFsndGVzdHN0YXJ0JywgJ3Rlc3Rtb3ZlJ10pXG5cbiAgaW50ZXJhY3RhYmxlLmZpcmUoeyB0eXBlOiAndGVzdGVuZCcgfSlcbiAgdC5kZWVwRXF1YWwoZmlyZWQubWFwKChlKSA9PiBlLnR5cGUpLCBbJ3Rlc3RzdGFydCcsICd0ZXN0bW92ZScsICd0ZXN0ZW5kJ10pXG5cbiAgZmlyZWQgPSBbXVxuICBpbnRlcmFjdGFibGUuc2V0UGVyQWN0aW9uKCd0ZXN0Jywge1xuICAgIGxpc3RlbmVyczogW3sgc3RhcnQ6IGFkZFRvRmlyZWQgfV0sXG4gIH0pXG5cbiAgaW50ZXJhY3RhYmxlLmZpcmUoeyB0eXBlOiAndGVzdHN0YXJ0JyB9KVxuICBpbnRlcmFjdGFibGUuZmlyZSh7IHR5cGU6ICd0ZXN0bW92ZScgfSlcbiAgaW50ZXJhY3RhYmxlLmZpcmUoeyB0eXBlOiAndGVzdGVuZCcgfSlcbiAgdC5kZWVwRXF1YWwoZmlyZWQubWFwKChlKSA9PiBlLnR5cGUpLCBbJ3Rlc3RzdGFydCddKVxuXG4gIGZpcmVkID0gW11cbiAgaW50ZXJhY3RhYmxlLnNldFBlckFjdGlvbigndGVzdCcsIHtcbiAgICBsaXN0ZW5lcnM6IG51bGwsXG4gIH0pXG5cbiAgaW50ZXJhY3RhYmxlLmZpcmUoeyB0eXBlOiAndGVzdHN0YXJ0JyB9KVxuICBpbnRlcmFjdGFibGUuZmlyZSh7IHR5cGU6ICd0ZXN0bW92ZScgfSlcbiAgaW50ZXJhY3RhYmxlLmZpcmUoeyB0eXBlOiAndGVzdGVuZCcgfSlcbiAgdC5kZWVwRXF1YWwoZmlyZWQsIFtdKVxuXG4gIHQuZW5kKClcbn0pXG4iXX0=