import test from '@interactjs/_dev/test/test';
import * as helpers from '@interactjs/core/tests/helpers';
import * as utils from '@interactjs/utils';
import modifiersBase from '../base';
test('modifiers/base', (t) => {
    const scope = helpers.mockScope();
    modifiersBase.install(scope);
    scope.actions.eventTypes.push('teststart', 'testmove', 'testend');
    // eslint-disable-next-line new-cap
    const interaction = scope.interactions.new({});
    t.ok(utils.is.object(interaction.modifiers), 'modifiers prop is added new Interaction');
    const element = utils.win.window.document.documentElement;
    const interactable = scope.interactables.new(element);
    const startEvent = {
        pageX: 100,
        pageY: 200,
        clientX: 100,
        clientY: 200,
        target: element,
    };
    const moveEvent = {
        pageX: 400,
        pageY: 500,
        clientX: 400,
        clientY: 500,
        target: element,
    };
    const options = { target: { x: 100, y: 100 }, setStart: true };
    let firedEvents = [];
    interactable.rectChecker(() => ({ top: 0, left: 0, bottom: 50, right: 50 }));
    interactable.on('teststart testmove testend', (event) => firedEvents.push(event));
    interaction.pointerDown(startEvent, startEvent, element);
    interactable.options.test = {
        modifiers: [
            {
                options,
                methods: targetModifier,
            },
        ],
    };
    interaction.start({ name: 'test' }, interactable, element);
    t.ok(options.started, 'modifier methods.start() was called');
    t.ok(options.setted, 'modifier methods.set() was called');
    t.deepEqual(interaction.prevEvent.page, options.target, 'start event coords are modified');
    t.deepEqual(interaction.coords.start.page, { x: 100, y: 200 }, 'interaction.coords.start are restored after action start phase');
    t.deepEqual(interaction.coords.cur.page, { x: 100, y: 200 }, 'interaction.coords.cur are restored after action start phase');
    interaction.pointerMove(moveEvent, moveEvent, element);
    t.deepEqual(interaction.coords.cur.page, { x: moveEvent.pageX, y: moveEvent.pageY }, 'interaction.coords.cur are restored after action move phase');
    t.deepEqual(interaction.coords.start.page, { x: startEvent.pageX, y: startEvent.pageY }, 'interaction.coords.start are restored after action move phase');
    t.deepEqual({ x: interaction.prevEvent.x0, y: interaction.prevEvent.y0 }, { x: 100, y: 100 }, 'move event start coords are modified');
    firedEvents = [];
    const similarMoveEvent = { ...moveEvent, pageX: moveEvent.pageX + 0.5 };
    interaction.pointerMove(similarMoveEvent, similarMoveEvent, element);
    t.equal(firedEvents.length, 0, 'duplicate result coords are ignored');
    interaction.stop();
    t.ok(options.stopped, 'modifier methods.stop() was called');
    // don't set start
    options.setStart = null;
    // add second modifier
    interactable.options.test.modifiers.push({
        options,
        methods: doubleModifier,
    });
    interaction.pointerDown(startEvent, startEvent, element);
    interaction.start({ name: 'test' }, interactable, element);
    t.notOk(options.setted, 'modifier methods.set() was not called on start phase without options.setStart');
    t.deepEqual(interaction.prevEvent.page, { x: 100, y: 200 }, 'start event coords are not modified without options.setStart');
    t.deepEqual(interaction.coords.start.page, { x: 100, y: 200 }, 'interaction.coords.start are not modified without options.setStart');
    interaction.pointerMove(moveEvent, moveEvent, element);
    t.deepEqual(interaction.prevEvent.page, { x: 200, y: 200 }, 'move event coords are modified by all modifiers');
    // modifier options.type
    scope.modifiers.target = modifiersBase.makeModifier(targetModifier);
    options.type = 'target';
    options.started = false;
    interactable.options.test = {
        modifiers: [
            options,
        ],
    };
    interaction.stop();
    interaction.start({ name: 'test' }, interactable, element);
    t.ok(options.started, 'gets `scpe.modifiers[options.type]`');
    t.end();
});
const targetModifier = {
    start({ state }) {
        state.options.started = true;
    },
    set({ state, coords }) {
        const { target } = state.options;
        coords.x = target.x;
        coords.y = target.y;
        state.options.setted = true;
    },
    stop({ state }) {
        state.options.stopped = true;
        delete state.options.started;
        delete state.options.setted;
    },
};
const doubleModifier = {
    start() { },
    set({ coords }) {
        coords.x *= 2;
        coords.y *= 2;
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxJQUFJLE1BQU0sNEJBQTRCLENBQUE7QUFDN0MsT0FBTyxLQUFLLE9BQU8sTUFBTSxnQ0FBZ0MsQ0FBQTtBQUN6RCxPQUFPLEtBQUssS0FBSyxNQUFNLG1CQUFtQixDQUFBO0FBQzFDLE9BQU8sYUFBYSxNQUFNLFNBQVMsQ0FBQTtBQUVuQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtJQUMzQixNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUE7SUFFakMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUM1QixLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLFVBQVUsRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUVqRSxtQ0FBbUM7SUFDbkMsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUE7SUFFOUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLEVBQUUseUNBQXlDLENBQUMsQ0FBQTtJQUV2RixNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFBO0lBQ3pELE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ3JELE1BQU0sVUFBVSxHQUFHO1FBQ2pCLEtBQUssRUFBRSxHQUFHO1FBQ1YsS0FBSyxFQUFFLEdBQUc7UUFDVixPQUFPLEVBQUUsR0FBRztRQUNaLE9BQU8sRUFBRSxHQUFHO1FBQ1osTUFBTSxFQUFFLE9BQU87S0FDaEIsQ0FBQTtJQUNELE1B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QUFFLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQTtRQUVoQyxNQUFNLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUE7UUFDbkIsTUFBTSxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFBO1FBRW5CLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQTtJQUM3QixDQUFDO0lBQ0QsSUFBSSxDQUFFLEVBQUUsS0FBSyxFQUFFO1FBQ2IsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFBO1FBQzVCLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUE7UUFDNUIsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQTtJQUM3QixDQUFDO0NBQ0YsQ0FBQTtBQUVELE1BQU0sY0FBYyxHQUFHO0lBQ3JCLEtBQUssS0FBSyxDQUFDO0lBQ1gsR0FBRyxDQUFFLEVBQUUsTUFBTSxFQUFFO1FBQ2IsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDYixNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNmLENBQUM7Q0FDRixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHRlc3QgZnJvbSAnQGludGVyYWN0anMvX2Rldi90ZXN0L3Rlc3QnXG5pbXBvcnQgKiBhcyBoZWxwZXJzIGZyb20gJ0BpbnRlcmFjdGpzL2NvcmUvdGVzdHMvaGVscGVycydcbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJ0BpbnRlcmFjdGpzL3V0aWxzJ1xuaW1wb3J0IG1vZGlmaWVyc0Jhc2UgZnJvbSAnLi4vYmFzZSdcblxudGVzdCgnbW9kaWZpZXJzL2Jhc2UnLCAodCkgPT4ge1xuICBjb25zdCBzY29wZSA9IGhlbHBlcnMubW9ja1Njb3BlKClcblxuICBtb2RpZmllcnNCYXNlLmluc3RhbGwoc2NvcGUpXG4gIHNjb3BlLmFjdGlvbnMuZXZlbnRUeXBlcy5wdXNoKCd0ZXN0c3RhcnQnLCAndGVzdG1vdmUnLCAndGVzdGVuZCcpXG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5ldy1jYXBcbiAgY29uc3QgaW50ZXJhY3Rpb24gPSBzY29wZS5pbnRlcmFjdGlvbnMubmV3KHt9KVxuXG4gIHQub2sodXRpbHMuaXMub2JqZWN0KGludGVyYWN0aW9uLm1vZGlmaWVycyksICdtb2RpZmllcnMgcHJvcCBpcyBhZGRlZCBuZXcgSW50ZXJhY3Rpb24nKVxuXG4gIGNvbnN0IGVsZW1lbnQgPSB1dGlscy53aW4ud2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFxuICBjb25zdCBpbnRlcmFjdGFibGUgPSBzY29wZS5pbnRlcmFjdGFibGVzLm5ldyhlbGVtZW50KVxuICBjb25zdCBzdGFydEV2ZW50ID0ge1xuICAgIHBhZ2VYOiAxMDAsXG4gICAgcGFnZVk6IDIwMCxcbiAgICBjbGllbnRYOiAxMDAsXG4gICAgY2xpZW50WTogMjAwLFxuICAgIHRhcmdldDogZWxlbWVudCxcbiAgfVxuICBjb25zdCBtb3ZlRXZlbnQgPSB7XG4gICAgcGFnZVg6IDQwMCxcbiAgICBwYWdlWTogNTAwLFxuICAgIGNsaWVudFg6IDQwMCxcbiAgICBjbGllbnRZOiA1MDAsXG4gICAgdGFyZ2V0OiBlbGVtZW50LFxuICB9XG4gIGNvbnN0IG9wdGlvbnM6IGFueSA9IHsgdGFyZ2V0OiB7IHg6IDEwMCwgeTogMTAwIH0sIHNldFN0YXJ0OiB0cnVlIH1cbiAgbGV0IGZpcmVkRXZlbnRzID0gW11cblxuICBpbnRlcmFjdGFibGUucmVjdENoZWNrZXIoKCkgPT4gKHsgdG9wOiAwLCBsZWZ0OiAwLCBib3R0b206IDUwLCByaWdodDogNTAgfSkpXG4gIGludGVyYWN0YWJsZS5vbigndGVzdHN0YXJ0IHRlc3Rtb3ZlIHRlc3RlbmQnLCAoZXZlbnQpID0+IGZpcmVkRXZlbnRzLnB1c2goZXZlbnQpKVxuICBpbnRlcmFjdGlvbi5wb2ludGVyRG93bihzdGFydEV2ZW50LCBzdGFydEV2ZW50LCBlbGVtZW50KVxuXG4gIGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QgPSB7XG4gICAgbW9kaWZpZXJzOiBbXG4gICAgICB7XG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIG1ldGhvZHM6IHRhcmdldE1vZGlmaWVyLFxuICAgICAgfSxcbiAgICBdLFxuICB9XG5cbiAgaW50ZXJhY3Rpb24uc3RhcnQoeyBuYW1lOiAndGVzdCcgfSwgaW50ZXJhY3RhYmxlLCBlbGVtZW50KVxuXG4gIHQub2soXG4gICAgb3B0aW9ucy5zdGFydGVkLFxuICAgICdtb2RpZmllciBtZXRob2RzLnN0YXJ0KCkgd2FzIGNhbGxlZCcsXG4gIClcblxuICB0Lm9rKFxuICAgIG9wdGlvbnMuc2V0dGVkLFxuICAgICdtb2RpZmllciBtZXRob2RzLnNldCgpIHdhcyBjYWxsZWQnLFxuICApXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgaW50ZXJhY3Rpb24ucHJldkV2ZW50LnBhZ2UsXG4gICAgb3B0aW9ucy50YXJnZXQsXG4gICAgJ3N0YXJ0IGV2ZW50IGNvb3JkcyBhcmUgbW9kaWZpZWQnKVxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIGludGVyYWN0aW9uLmNvb3Jkcy5zdGFydC5wYWdlLFxuICAgIHsgeDogMTAwLCB5OiAyMDAgfSxcbiAgICAnaW50ZXJhY3Rpb24uY29vcmRzLnN0YXJ0IGFyZSByZXN0b3JlZCBhZnRlciBhY3Rpb24gc3RhcnQgcGhhc2UnKVxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIGludGVyYWN0aW9uLmNvb3Jkcy5jdXIucGFnZSxcbiAgICB7IHg6IDEwMCwgeTogMjAwIH0sXG4gICAgJ2ludGVyYWN0aW9uLmNvb3Jkcy5jdXIgYXJlIHJlc3RvcmVkIGFmdGVyIGFjdGlvbiBzdGFydCBwaGFzZScpXG5cbiAgaW50ZXJhY3Rpb24ucG9pbnRlck1vdmUobW92ZUV2ZW50LCBtb3ZlRXZlbnQsIGVsZW1lbnQpXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgaW50ZXJhY3Rpb24uY29vcmRzLmN1ci5wYWdlLFxuICAgIHsgeDogbW92ZUV2ZW50LnBhZ2VYLCB5OiBtb3ZlRXZlbnQucGFnZVkgfSxcbiAgICAnaW50ZXJhY3Rpb24uY29vcmRzLmN1ciBhcmUgcmVzdG9yZWQgYWZ0ZXIgYWN0aW9uIG1vdmUgcGhhc2UnKVxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIGludGVyYWN0aW9uLmNvb3Jkcy5zdGFydC5wYWdlLFxuICAgIHsgeDogc3RhcnRFdmVudC5wYWdlWCwgeTogc3RhcnRFdmVudC5wYWdlWSB9LFxuICAgICdpbnRlcmFjdGlvbi5jb29yZHMuc3RhcnQgYXJlIHJlc3RvcmVkIGFmdGVyIGFjdGlvbiBtb3ZlIHBoYXNlJylcblxuICB0LmRlZXBFcXVhbChcbiAgICB7IHg6IGludGVyYWN0aW9uLnByZXZFdmVudC54MCwgeTogaW50ZXJhY3Rpb24ucHJldkV2ZW50LnkwIH0sXG4gICAgeyB4OiAxMDAsIHk6IDEwMCB9LFxuICAgICdtb3ZlIGV2ZW50IHN0YXJ0IGNvb3JkcyBhcmUgbW9kaWZpZWQnKVxuXG4gIGZpcmVkRXZlbnRzID0gW11cbiAgY29uc3Qgc2ltaWxhck1vdmVFdmVudCA9IHsgLi4ubW92ZUV2ZW50LCBwYWdlWDogbW92ZUV2ZW50LnBhZ2VYICsgMC41IH1cbiAgaW50ZXJhY3Rpb24ucG9pbnRlck1vdmUoc2ltaWxhck1vdmVFdmVudCwgc2ltaWxhck1vdmVFdmVudCwgZWxlbWVudClcbiAgdC5lcXVhbChmaXJlZEV2ZW50cy5sZW5ndGgsIDAsICdkdXBsaWNhdGUgcmVzdWx0IGNvb3JkcyBhcmUgaWdub3JlZCcpXG5cbiAgaW50ZXJhY3Rpb24uc3RvcCgpXG5cbiAgdC5vayhcbiAgICBvcHRpb25zLnN0b3BwZWQsXG4gICAgJ21vZGlmaWVyIG1ldGhvZHMuc3RvcCgpIHdhcyBjYWxsZWQnLFxuICApXG5cbiAgLy8gZG9uJ3Qgc2V0IHN0YXJ0XG4gIG9wdGlvbnMuc2V0U3RhcnQgPSBudWxsXG4gIC8vIGFkZCBzZWNvbmQgbW9kaWZpZXJcbiAgaW50ZXJhY3RhYmxlLm9wdGlvbnMudGVzdC5tb2RpZmllcnMucHVzaCh7XG4gICAgb3B0aW9ucyxcbiAgICBtZXRob2RzOiBkb3VibGVNb2RpZmllcixcbiAgfSlcblxuICBpbnRlcmFjdGlvbi5wb2ludGVyRG93bihzdGFydEV2ZW50LCBzdGFydEV2ZW50LCBlbGVtZW50KVxuICBpbnRlcmFjdGlvbi5zdGFydCh7IG5hbWU6ICd0ZXN0JyB9LCBpbnRlcmFjdGFibGUsIGVsZW1lbnQpXG5cbiAgdC5ub3RPayhcbiAgICBvcHRpb25zLnNldHRlZCxcbiAgICAnbW9kaWZpZXIgbWV0aG9kcy5zZXQoKSB3YXMgbm90IGNhbGxlZCBvbiBzdGFydCBwaGFzZSB3aXRob3V0IG9wdGlvbnMuc2V0U3RhcnQnLFxuICApXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgaW50ZXJhY3Rpb24ucHJldkV2ZW50LnBhZ2UsXG4gICAgeyB4OiAxMDAsIHk6IDIwMCB9LFxuICAgICdzdGFydCBldmVudCBjb29yZHMgYXJlIG5vdCBtb2RpZmllZCB3aXRob3V0IG9wdGlvbnMuc2V0U3RhcnQnKVxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIGludGVyYWN0aW9uLmNvb3Jkcy5zdGFydC5wYWdlLFxuICAgIHsgeDogMTAwLCB5OiAyMDAgfSxcbiAgICAnaW50ZXJhY3Rpb24uY29vcmRzLnN0YXJ0IGFyZSBub3QgbW9kaWZpZWQgd2l0aG91dCBvcHRpb25zLnNldFN0YXJ0JylcblxuICBpbnRlcmFjdGlvbi5wb2ludGVyTW92ZShtb3ZlRXZlbnQsIG1vdmVFdmVudCwgZWxlbWVudClcblxuICB0LmRlZXBFcXVhbChcbiAgICBpbnRlcmFjdGlvbi5wcmV2RXZlbnQucGFnZSxcbiAgICB7IHg6IDIwMCwgeTogMjAwIH0sXG4gICAgJ21vdmUgZXZlbnQgY29vcmRzIGFyZSBtb2RpZmllZCBieSBhbGwgbW9kaWZpZXJzJylcblxuICAvLyBtb2RpZmllciBvcHRpb25zLnR5cGVcbiAgc2NvcGUubW9kaWZpZXJzLnRhcmdldCA9IG1vZGlmaWVyc0Jhc2UubWFrZU1vZGlmaWVyKHRhcmdldE1vZGlmaWVyKVxuICBvcHRpb25zLnR5cGUgPSAndGFyZ2V0J1xuICBvcHRpb25zLnN0YXJ0ZWQgPSBmYWxzZVxuICBpbnRlcmFjdGFibGUub3B0aW9ucy50ZXN0ID0ge1xuICAgIG1vZGlmaWVyczogW1xuICAgICAgb3B0aW9ucyxcbiAgICBdLFxuICB9XG4gIGludGVyYWN0aW9uLnN0b3AoKVxuICBpbnRlcmFjdGlvbi5zdGFydCh7IG5hbWU6ICd0ZXN0JyB9LCBpbnRlcmFjdGFibGUsIGVsZW1lbnQpXG5cbiAgdC5vayhvcHRpb25zLnN0YXJ0ZWQsICdnZXRzIGBzY3BlLm1vZGlmaWVyc1tvcHRpb25zLnR5cGVdYCcpXG5cbiAgdC5lbmQoKVxufSlcblxuY29uc3QgdGFyZ2V0TW9kaWZpZXIgPSB7XG4gIHN0YXJ0ICh7IHN0YXRlIH0pIHtcbiAgICBzdGF0ZS5vcHRpb25zLnN0YXJ0ZWQgPSB0cnVlXG4gIH0sXG4gIHNldCAoeyBzdGF0ZSwgY29vcmRzIH0pIHtcbiAgICBjb25zdCB7IHRhcmdldCB9ID0gc3RhdGUub3B0aW9uc1xuXG4gICAgY29vcmRzLnggPSB0YXJnZXQueFxuICAgIGNvb3Jkcy55ID0gdGFyZ2V0LnlcblxuICAgIHN0YXRlLm9wdGlvbnMuc2V0dGVkID0gdHJ1ZVxuICB9LFxuICBzdG9wICh7IHN0YXRlIH0pIHtcbiAgICBzdGF0ZS5vcHRpb25zLnN0b3BwZWQgPSB0cnVlXG4gICAgZGVsZXRlIHN0YXRlLm9wdGlvbnMuc3RhcnRlZFxuICAgIGRlbGV0ZSBzdGF0ZS5vcHRpb25zLnNldHRlZFxuICB9LFxufVxuXG5jb25zdCBkb3VibGVNb2RpZmllciA9IHtcbiAgc3RhcnQgKCkge30sXG4gIHNldCAoeyBjb29yZHMgfSkge1xuICAgIGNvb3Jkcy54ICo9IDJcbiAgICBjb29yZHMueSAqPSAyXG4gIH0sXG59XG4iXX0=