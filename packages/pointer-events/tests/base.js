import Eventable from '@interactjs/core/Eventable';
import Interaction from '@interactjs/core/Interaction';
import interactions from '@interactjs/core/interactions';
import * as helpers from '@interactjs/core/tests/helpers';
import Signals from '@interactjs/utils/Signals';
import test from '@interactjs/_dev/test/test';
import pointerEvents from '../base';
test('pointerEvents.types', t => {
    t.deepEqual(pointerEvents.types, [
        'down',
        'move',
        'up',
        'cancel',
        'tap',
        'doubletap',
        'hold',
    ], 'pointerEvents.types is as expected');
    t.end();
});
test('pointerEvents.fire', t => {
    const eventable = new Eventable(pointerEvents.defaults);
    const type = 'TEST';
    const element = {};
    const eventTarget = {};
    const TEST_PROP = ['TEST_PROP'];
    let firedEvent;
    eventable.on(type, event => { firedEvent = event; });
    pointerEvents.fire({
        type,
        eventTarget,
        pointer: {},
        event: {},
        interaction: {},
        targets: [{
                eventable,
                element,
                props: {
                    TEST_PROP,
                },
            }],
    });
    t.ok(firedEvent instanceof pointerEvents.PointerEvent, 'Fired event is an instance of pointerEvents.PointerEvent');
    t.equal(firedEvent.type, type, 'Fired event type is correct');
    t.equal(firedEvent.currentTarget, element, 'Fired event currentTarget is correct');
    t.equal(firedEvent.target, eventTarget, 'Fired event target is correct');
    t.equal(firedEvent.TEST_PROP, TEST_PROP, 'Fired event has props from target.props');
    const tapTime = 500;
    const interaction = Object.assign(new Interaction({ signals: new Signals() }), { tapTime: -1, prevTap: null });
    interaction.updatePointer({}, {}, null);
    const tapEvent = Object.assign(new pointerEvents.PointerEvent('tap', {}, {}, null, interaction), {
        timeStamp: tapTime,
    });
    pointerEvents.fire({
        pointerEvent: tapEvent,
        interaction,
        targets: [{
                eventable,
                element,
            }],
    });
    t.equal(interaction.tapTime, tapTime, 'interaction.tapTime is updated');
    t.equal(interaction.prevTap, tapEvent, 'interaction.prevTap is updated');
    t.end();
});
test('pointerEvents.collectEventTargets', t => {
    const type = 'TEST';
    const TEST_PROP = ['TEST_PROP'];
    const target = {
        TEST_PROP,
        eventable: new Eventable(pointerEvents.defaults),
    };
    let collectedTargets;
    function onCollect({ targets }) {
        targets.push(target);
        collectedTargets = targets;
    }
    pointerEvents.signals.on('collect-targets', onCollect);
    pointerEvents.collectEventTargets({
        interaction: new Interaction({ signals: helpers.mockSignals() }),
        pointer: {},
        event: {},
        eventTarget: {},
        type,
    });
    t.deepEqual(collectedTargets, [target]);
    pointerEvents.signals.off('collect-targets', onCollect);
    t.end();
});
test('pointerEvents Interaction update-pointer signal', t => {
    const scope = helpers.mockScope();
    interactions.install(scope);
    pointerEvents.install(scope);
    const interaction = scope.interactions.new({});
    const initialHold = { duration: Infinity, timeout: null };
    const event = {};
    interaction.updatePointer(helpers.newPointer(0), event, null, false);
    t.deepEqual(interaction.pointers.map(p => p.hold), [initialHold], 'set hold info for move on new pointer');
    interaction.removePointer(helpers.newPointer(0), event);
    interaction.updatePointer(helpers.newPointer(0), event, null, true);
    t.deepEqual(interaction.pointers.map(p => p.hold), [initialHold]);
    interaction.updatePointer(helpers.newPointer(5), event, null, true);
    t.deepEqual(interaction.pointers.map(p => p.hold), [initialHold, initialHold]);
    t.end();
});
test('pointerEvents Interaction remove-pointer signal', t => {
    const scope = helpers.mockScope();
    interactions.install(scope);
    pointerEvents.install(scope);
    const interaction = scope.interactions.new({});
    const ids = [0, 1, 2, 3];
    const removals = [
        { id: 0, remain: [1, 2, 3], message: 'first of 4' },
        { id: 2, remain: [1, 3], message: 'middle of 3' },
        { id: 3, remain: [1], message: 'last of 2' },
        { id: 1, remain: [], message: 'final' },
    ];
    for (const id of ids) {
        const index = interaction.updatePointer({ pointerId: id }, {}, null, true);
        // use the ids as the pointerInfo.hold value for this test
        interaction.pointers[index].hold = id;
    }
    for (const removal of removals) {
        interaction.removePointer({ pointerId: removal.id }, null);
        t.deepEqual(interaction.pointers.map(p => p.hold), removal.remain, `${removal.message} - remaining interaction.holdTimers is correct`);
    }
    t.end();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxTQUFTLE1BQU0sNEJBQTRCLENBQUE7QUFDbEQsT0FBTyxXQUFXLE1BQU0sOEJBQThCLENBQUE7QUFDdEQsT0FBTyxZQUFZLE1BQU0sK0JBQStCLENBQUE7QUFDeEQsT0FBTyxLQUFLLE9BQU8sTUFBTSxnQ0FBZ0MsQ0FBQTtBQUN6RCxPQUFPLE9BQU8sTUFBTSwyQkFBMkIsQ0FBQTtBQUMvQyxPQUFPLElBQUksTUFBTSw0QkFBNEIsQ0FBQTtBQUM3QyxPQUFPLGFBQWEsTUFBTSxTQUFTLENBQUE7QUFFbkMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUMsQ0FBQyxFQUFFO0lBQzlCLENBQUMsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLEtBQUssRUFDN0I7UUFDRSxNQUFNO1FBQ04sTUFBTTtRQUNOLElBQUk7UUFDSixRQUFRO1FBQ1IsS0FBSztRQUNMLFdBQVc7UUFDWCxNQUFNO0tBQ1AsRUFDRCxvQ0FBb0MsQ0FBQyxDQUFBO0lBRXZDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtBQUNULENBQUMsQ0FBQyxDQUFBO0FBRUYsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxFQUFFO0lBQzdCLE1BQU0sU0FBUyxHQUFHLElBQUksU0FBUyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUN2RCxNQUFNLElBQUksR0FBRyxNQUFNLENBQUE7SUFDbkIsTUFBTSxPQUFPLEdBQUcsRUFBRSxDQUFBO0lBQ2xCLE1BQU0sV0FBVyxHQUFHLEVBQUUsQ0FBQTtJQUN0QixNQUFNLFNBQVMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFBO0lBQy9CLElBQUksVUFBVSxDQUFBO0lBRWQsU0FBUyxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLEVBQUUsR0FBRyxVQUFVLEdBQUcsS0FBSyxDQUFBLENBQUMs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dGVudCI6WyJpbXBvcnQgRXZlbnRhYmxlIGZyb20gJ0BpbnRlcmFjdGpzL2NvcmUvRXZlbnRhYmxlJ1xuaW1wb3J0IEludGVyYWN0aW9uIGZyb20gJ0BpbnRlcmFjdGpzL2NvcmUvSW50ZXJhY3Rpb24nXG5pbXBvcnQgaW50ZXJhY3Rpb25zIGZyb20gJ0BpbnRlcmFjdGpzL2NvcmUvaW50ZXJhY3Rpb25zJ1xuaW1wb3J0ICogYXMgaGVscGVycyBmcm9tICdAaW50ZXJhY3Rqcy9jb3JlL3Rlc3RzL2hlbHBlcnMnXG5pbXBvcnQgU2lnbmFscyBmcm9tICdAaW50ZXJhY3Rqcy91dGlscy9TaWduYWxzJ1xuaW1wb3J0IHRlc3QgZnJvbSAnQGludGVyYWN0anMvX2Rldi90ZXN0L3Rlc3QnXG5pbXBvcnQgcG9pbnRlckV2ZW50cyBmcm9tICcuLi9iYXNlJ1xuXG50ZXN0KCdwb2ludGVyRXZlbnRzLnR5cGVzJywgdCA9PiB7XG4gIHQuZGVlcEVxdWFsKHBvaW50ZXJFdmVudHMudHlwZXMsXG4gICAgW1xuICAgICAgJ2Rvd24nLFxuICAgICAgJ21vdmUnLFxuICAgICAgJ3VwJyxcbiAgICAgICdjYW5jZWwnLFxuICAgICAgJ3RhcCcsXG4gICAgICAnZG91YmxldGFwJyxcbiAgICAgICdob2xkJyxcbiAgICBdLFxuICAgICdwb2ludGVyRXZlbnRzLnR5cGVzIGlzIGFzIGV4cGVjdGVkJylcblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdwb2ludGVyRXZlbnRzLmZpcmUnLCB0ID0+IHtcbiAgY29uc3QgZXZlbnRhYmxlID0gbmV3IEV2ZW50YWJsZShwb2ludGVyRXZlbnRzLmRlZmF1bHRzKVxuICBjb25zdCB0eXBlID0gJ1RFU1QnXG4gIGNvbnN0IGVsZW1lbnQgPSB7fVxuICBjb25zdCBldmVudFRhcmdldCA9IHt9XG4gIGNvbnN0IFRFU1RfUFJPUCA9IFsnVEVTVF9QUk9QJ11cbiAgbGV0IGZpcmVkRXZlbnRcblxuICBldmVudGFibGUub24odHlwZSwgZXZlbnQgPT4geyBmaXJlZEV2ZW50ID0gZXZlbnQgfSlcblxuICBwb2ludGVyRXZlbnRzLmZpcmUoe1xuICAgIHR5cGUsXG4gICAgZXZlbnRUYXJnZXQsXG4gICAgcG9pbnRlcjoge30sXG4gICAgZXZlbnQ6IHt9LFxuICAgIGludGVyYWN0aW9uOiB7fSxcbiAgICB0YXJnZXRzOiBbe1xuICAgICAgZXZlbnRhYmxlLFxuICAgICAgZWxlbWVudCxcbiAgICAgIHByb3BzOiB7XG4gICAgICAgIFRFU1RfUFJPUCxcbiAgICAgIH0sXG4gICAgfV0sXG4gIH0gYXMgYW55KVxuXG4gIHQub2soZmlyZWRFdmVudCBpbnN0YW5jZW9mIHBvaW50ZXJFdmVudHMuUG9pbnRlckV2ZW50LFxuICAgICdGaXJlZCBldmVudCBpcyBhbiBpbnN0YW5jZSBvZiBwb2ludGVyRXZlbnRzLlBvaW50ZXJFdmVudCcpXG4gIHQuZXF1YWwoZmlyZWRFdmVudC50eXBlLCB0eXBlLFxuICAgICdGaXJlZCBldmVudCB0eXBlIGlzIGNvcnJlY3QnKVxuICB0LmVxdWFsKGZpcmVkRXZlbnQuY3VycmVudFRhcmdldCwgZWxlbWVudCxcbiAgICAnRmlyZWQgZXZlbnQgY3VycmVudFRhcmdldCBpcyBjb3JyZWN0JylcbiAgdC5lcXVhbChmaXJlZEV2ZW50LnRhcmdldCwgZXZlbnRUYXJnZXQsXG4gICAgJ0ZpcmVkIGV2ZW50IHRhcmdldCBpcyBjb3JyZWN0JylcbiAgdC5lcXVhbChmaXJlZEV2ZW50LlRFU1RfUFJPUCwgVEVTVF9QUk9QLFxuICAgICdGaXJlZCBldmVudCBoYXMgcHJvcHMgZnJvbSB0YXJnZXQucHJvcHMnKVxuXG4gIGNvbnN0IHRhcFRpbWUgPSA1MDBcbiAgY29uc3QgaW50ZXJhY3Rpb24gPSBPYmplY3QuYXNzaWduKFxuICAgIG5ldyBJbnRlcmFjdGlvbih7IHNpZ25hbHM6IG5ldyBTaWduYWxzKCkgfSBhcyBhbnkpLFxuICAgIHsgdGFwVGltZTogLTEsIHByZXZUYXA6IG51bGwgfSlcblxuICBpbnRlcmFjdGlvbi51cGRhdGVQb2ludGVyKHt9IGFzIGFueSwge30gYXMgYW55LCBudWxsKVxuXG4gIGNvbnN0IHRhcEV2ZW50ID0gT2JqZWN0LmFzc2lnbihuZXcgcG9pbnRlckV2ZW50cy5Qb2ludGVyRXZlbnQoJ3RhcCcsIHt9LCB7fSwgbnVsbCwgaW50ZXJhY3Rpb24pLCB7XG4gICAgdGltZVN0YW1wOiB0YXBUaW1lLFxuICB9KVxuXG4gIHBvaW50ZXJFdmVudHMuZmlyZSh7XG4gICAgcG9pbnRlckV2ZW50OiB0YXBFdmVudCxcbiAgICBpbnRlcmFjdGlvbixcbiAgICB0YXJnZXRzOiBbe1xuICAgICAgZXZlbnRhYmxlLFxuICAgICAgZWxlbWVudCxcbiAgICB9XSxcbiAgfSBhcyBhbnkpXG5cbiAgdC5lcXVhbChpbnRlcmFjdGlvbi50YXBUaW1lLCB0YXBUaW1lLFxuICAgICdpbnRlcmFjdGlvbi50YXBUaW1lIGlzIHVwZGF0ZWQnKVxuICB0LmVxdWFsKGludGVyYWN0aW9uLnByZXZUYXAsIHRhcEV2ZW50LFxuICAgICdpbnRlcmFjdGlvbi5wcmV2VGFwIGlzIHVwZGF0ZWQnKVxuXG4gIHQuZW5kKClcbn0pXG5cbnRlc3QoJ3BvaW50ZXJFdmVudHMuY29sbGVjdEV2ZW50VGFyZ2V0cycsIHQgPT4ge1xuICBjb25zdCB0eXBlID0gJ1RFU1QnXG4gIGNvbnN0IFRFU1RfUFJPUCA9IFsnVEVTVF9QUk9QJ11cbiAgY29uc3QgdGFyZ2V0ID0ge1xuICAgIFRFU1RfUFJPUCxcbiAgICBldmVudGFibGU6IG5ldyBFdmVudGFibGUocG9pbnRlckV2ZW50cy5kZWZhdWx0cyksXG4gIH1cbiAgbGV0IGNvbGxlY3RlZFRhcmdldHNcblxuICBmdW5jdGlvbiBvbkNvbGxlY3QgKHsgdGFyZ2V0cyB9KSB7XG4gICAgdGFyZ2V0cy5wdXNoKHRhcmdldClcblxuICAgIGNvbGxlY3RlZFRhcmdldHMgPSB0YXJnZXRzXG4gIH1cblxuICBwb2ludGVyRXZlbnRzLnNpZ25hbHMub24oJ2NvbGxlY3QtdGFyZ2V0cycsIG9uQ29sbGVjdClcbiAgcG9pbnRlckV2ZW50cy5jb2xsZWN0RXZlbnRUYXJnZXRzKHtcbiAgICBpbnRlcmFjdGlvbjogbmV3IEludGVyYWN0aW9uKHsgc2lnbmFsczogaGVscGVycy5tb2NrU2lnbmFscygpIH0gYXMgYW55KSxcbiAgICBwb2ludGVyOiB7fSxcbiAgICBldmVudDoge30sXG4gICAgZXZlbnRUYXJnZXQ6IHt9LFxuICAgIHR5cGUsXG4gIH0gYXMgYW55KVxuXG4gIHQuZGVlcEVxdWFsKGNvbGxlY3RlZFRhcmdldHMsIFt0YXJnZXRdKVxuXG4gIHBvaW50ZXJFdmVudHMuc2lnbmFscy5vZmYoJ2NvbGxlY3QtdGFyZ2V0cycsIG9uQ29sbGVjdClcblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdwb2ludGVyRXZlbnRzIEludGVyYWN0aW9uIHVwZGF0ZS1wb2ludGVyIHNpZ25hbCcsIHQgPT4ge1xuICBjb25zdCBzY29wZSA9IGhlbHBlcnMubW9ja1Njb3BlKClcblxuICBpbnRlcmFjdGlvbnMuaW5zdGFsbChzY29wZSlcbiAgcG9pbnRlckV2ZW50cy5pbnN0YWxsKHNjb3BlKVxuXG4gIGNvbnN0IGludGVyYWN0aW9uID0gc2NvcGUuaW50ZXJhY3Rpb25zLm5ldyh7fSlcbiAgY29uc3QgaW5pdGlhbEhvbGQgPSB7IGR1cmF0aW9uOiBJbmZpbml0eSwgdGltZW91dDogbnVsbCB9XG4gIGNvbnN0IGV2ZW50ID0ge30gYXMgSW50ZXJhY3QuUG9pbnRlckV2ZW50VHlwZVxuXG4gIGludGVyYWN0aW9uLnVwZGF0ZVBvaW50ZXIoaGVscGVycy5uZXdQb2ludGVyKDApLCBldmVudCwgbnVsbCwgZmFsc2UpXG4gIHQuZGVlcEVxdWFsKGludGVyYWN0aW9uLnBvaW50ZXJzLm1hcChwID0+IHAuaG9sZCksIFtpbml0aWFsSG9sZF0sICdzZXQgaG9sZCBpbmZvIGZvciBtb3ZlIG9uIG5ldyBwb2ludGVyJylcblxuICBpbnRlcmFjdGlvbi5yZW1vdmVQb2ludGVyKGhlbHBlcnMubmV3UG9pbnRlcigwKSwgZXZlbnQpXG5cbiAgaW50ZXJhY3Rpb24udXBkYXRlUG9pbnRlcihoZWxwZXJzLm5ld1BvaW50ZXIoMCksIGV2ZW50LCBudWxsLCB0cnVlKVxuICB0LmRlZXBFcXVhbChpbnRlcmFjdGlvbi5wb2ludGVycy5tYXAocCA9PiBwLmhvbGQpLCBbaW5pdGlhbEhvbGRdKVxuXG4gIGludGVyYWN0aW9uLnVwZGF0ZVBvaW50ZXIoaGVscGVycy5uZXdQb2ludGVyKDUpLCBldmVudCwgbnVsbCwgdHJ1ZSlcbiAgdC5kZWVwRXF1YWwoaW50ZXJhY3Rpb24ucG9pbnRlcnMubWFwKHAgPT4gcC5ob2xkKSwgW2luaXRpYWxIb2xkLCBpbml0aWFsSG9sZF0pXG5cbiAgdC5lbmQoKVxufSlcblxudGVzdCgncG9pbnRlckV2ZW50cyBJbnRlcmFjdGlvbiByZW1vdmUtcG9pbnRlciBzaWduYWwnLCB0ID0+IHtcbiAgY29uc3Qgc2NvcGUgPSBoZWxwZXJzLm1vY2tTY29wZSgpXG5cbiAgaW50ZXJhY3Rpb25zLmluc3RhbGwoc2NvcGUpXG4gIHBvaW50ZXJFdmVudHMuaW5zdGFsbChzY29wZSlcblxuICBjb25zdCBpbnRlcmFjdGlvbiA9IHNjb3BlLmludGVyYWN0aW9ucy5uZXcoe30pXG5cbiAgY29uc3QgaWRzID0gWzAsIDEsIDIsIDNdXG4gIGNvbnN0IHJlbW92YWxzID0gW1xuICAgIHsgaWQ6IDAsIHJlbWFpbjogWzEsIDIsIDNdLCBtZXNzYWdlOiAnZmlyc3Qgb2YgNCcgIH0sXG4gICAgeyBpZDogMiwgcmVtYWluOiBbMSwgICAgM10sIG1lc3NhZ2U6ICdtaWRkbGUgb2YgMycgfSxcbiAgICB7IGlkOiAzLCByZW1haW46IFsxICAgICAgXSwgbWVzc2FnZTogJ2xhc3Qgb2YgMicgICB9LFxuICAgIHsgaWQ6IDEsIHJlbWFpbjogWyAgICAgICBdLCBtZXNzYWdlOiAnZmluYWwnICAgICAgIH0sXG4gIF1cblxuICBmb3IgKGNvbnN0IGlkIG9mIGlkcykge1xuICAgIGNvbnN0IGluZGV4ID0gaW50ZXJhY3Rpb24udXBkYXRlUG9pbnRlcih7IHBvaW50ZXJJZDogaWQgfSBhcyBJbnRlcmFjdC5Qb2ludGVyVHlwZSwge30gYXMgSW50ZXJhY3QuUG9pbnRlckV2ZW50VHlwZSwgbnVsbCwgdHJ1ZSlcbiAgICAvLyB1c2UgdGhlIGlkcyBhcyB0aGUgcG9pbnRlckluZm8uaG9sZCB2YWx1ZSBmb3IgdGhpcyB0ZXN0XG4gICAgaW50ZXJhY3Rpb24ucG9pbnRlcnNbaW5kZXhdLmhvbGQgPSBpZCBhcyBhbnlcbiAgfVxuXG4gIGZvciAoY29uc3QgcmVtb3ZhbCBvZiByZW1vdmFscykge1xuICAgIGludGVyYWN0aW9uLnJlbW92ZVBvaW50ZXIoeyBwb2ludGVySWQ6IHJlbW92YWwuaWQgfSBhcyBhbnksIG51bGwpXG5cbiAgICB0LmRlZXBFcXVhbChpbnRlcmFjdGlvbi5wb2ludGVycy5tYXAocCA9PiBwLmhvbGQpLCByZW1vdmFsLnJlbWFpbixcbiAgICAgIGAke3JlbW92YWwubWVzc2FnZX0gLSByZW1haW5pbmcgaW50ZXJhY3Rpb24uaG9sZFRpbWVycyBpcyBjb3JyZWN0YClcbiAgfVxuXG4gIHQuZW5kKClcbn0pXG4iXX0=