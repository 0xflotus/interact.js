import interactions from '@interactjs/core/interactions';
import * as helpers from '@interactjs/core/tests/helpers';
import win from '@interactjs/utils/window';
import test from '@interactjs/_dev/test/test';
import reflow from '../';
test('reflow', t => {
    const scope = helpers.mockScope();
    interactions.install(scope);
    Object.assign(scope.actions, { test: {}, names: ['test'] });
    reflow.install(scope);
    t.ok(scope.Interactable.prototype.reflow instanceof Function, 'reflow method is added to Interactable.prototype');
    const fired = [];
    const interactable = scope.interactables.new(win.window);
    const rect = Object.freeze({ top: 100, left: 200, bottom: 300, right: 400 });
    interactable.fire = (iEvent => { fired.push(iEvent); });
    interactable.target = {};
    interactable.options.test = {};
    interactable.rectChecker(() => ({ ...rect }));
    // modify move coords
    scope.interactions.signals.on('before-action-move', ({ interaction }) => {
        interaction.coords.cur.page = {
            x: rect.left + 100,
            y: rect.top - 50,
        };
    });
    interactable.reflow({ name: 'test' });
    const phases = ['reflow', 'start', 'move', 'end'];
    for (const index in phases) {
        const phase = phases[index];
        t.equal(fired[index].type, `test${phase}`, `event #${index} is ${phase}`);
    }
    const interaction = fired[0].interaction;
    t.deepEqual(interaction.coords.start.page, {
        x: rect.left,
        y: rect.top,
    }, 'uses element top left for event coords');
    const reflowMove = fired[2];
    t.deepEqual(reflowMove.delta, { x: 100, y: -50 }, 'move delta is correct with modified interaction coords');
    t.notOk(interaction.pointerIsDown, 'reflow pointer was lifted');
    t.equal(interaction.pointers.length, 0, 'reflow pointer was removed from interaction');
    t.notOk(scope.interactions.list.includes(interaction), 'interaction is removed from list');
    t.end();
});
test('async reflow', async (t) => {
    const scope = helpers.mockScope();
    interactions.install(scope);
    Object.assign(scope.actions, { test: {}, names: ['test'] });
    let reflowEvent;
    let promise;
    const interactable = scope.interactables.new(win.window);
    const rect = Object.freeze({ top: 100, left: 200, bottom: 300, right: 400 });
    interactable.rectChecker(() => ({ ...rect }));
    interactable.fire = (iEvent => { reflowEvent = iEvent; });
    reflow.install(scope);
    promise = interactable.reflow({ name: 'test' });
    t.ok(promise instanceof win.window.Promise, 'method returns a Promise');
    t.notOk(reflowEvent.interaction.interacting(), 'reflow may end synchronously');
    t.equal(await promise, interactable, 'returned Promise resolves to interactable');
    // block the end of the reflow interaction and stop it after a timeout
    scope.interactions.signals.on('before-action-end', ({ interaction }) => {
        setTimeout(() => interaction.stop(), 0);
        return false;
    });
    promise = interactable.reflow({ name: 'test' });
    t.ok(reflowEvent.interaction.interacting(), 'interaction continues if end is blocked');
    await promise;
    t.notOk(reflowEvent.interaction.interacting(), 'interaction is stopped after promise is resolved');
    t.end();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLFlBQVksTUFBTSwrQkFBK0IsQ0FBQTtBQUN4RCxPQUFPLEtBQUssT0FBTyxNQUFNLGdDQUFnQyxDQUFBO0FBQ3pELE9BQU8sR0FBRyxNQUFNLDBCQUEwQixDQUFBO0FBQzFDLE9BQU8sSUFBSSxNQUFNLDRCQUE0QixDQUFBO0FBQzdDLE9BQU8sTUFBTSxNQUFNLEtBQUssQ0FBQTtBQUV4QixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxFQUFFO0lBQ2pCLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQTtJQUVqQyxZQUFZLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBRTNCLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBRTNELE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7SUFFckIsQ0FBQyxDQUFDLEVBQUUsQ0FDRixLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxNQUFNLFlBQVksUUFBUSxFQUN2RCxrREFBa0QsQ0FDbkQsQ0FBQTtJQUVELE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQTtJQUNoQixNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDeEQsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFBO0lBRTVFLFlBQVksQ0FBQyxJQUFJLEdB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QUN2QyxPQUFPLEtBQUssQ0FBQTtJQUNkLENBQUMsQ0FBQyxDQUFBO0lBRUYsT0FBTyxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQTtJQUUvQyxDQUFDLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLEVBQUUseUNBQXlDLENBQUMsQ0FBQTtJQUN0RixNQUFNLE9BQU8sQ0FBQTtJQUNiLENBQUMsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsRUFBRSxrREFBa0QsQ0FBQyxDQUFBO0lBRWxHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtBQUNULENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGludGVyYWN0aW9ucyBmcm9tICdAaW50ZXJhY3Rqcy9jb3JlL2ludGVyYWN0aW9ucydcbmltcG9ydCAqIGFzIGhlbHBlcnMgZnJvbSAnQGludGVyYWN0anMvY29yZS90ZXN0cy9oZWxwZXJzJ1xuaW1wb3J0IHdpbiBmcm9tICdAaW50ZXJhY3Rqcy91dGlscy93aW5kb3cnXG5pbXBvcnQgdGVzdCBmcm9tICdAaW50ZXJhY3Rqcy9fZGV2L3Rlc3QvdGVzdCdcbmltcG9ydCByZWZsb3cgZnJvbSAnLi4vJ1xuXG50ZXN0KCdyZWZsb3cnLCB0ID0+IHtcbiAgY29uc3Qgc2NvcGUgPSBoZWxwZXJzLm1vY2tTY29wZSgpXG5cbiAgaW50ZXJhY3Rpb25zLmluc3RhbGwoc2NvcGUpXG5cbiAgT2JqZWN0LmFzc2lnbihzY29wZS5hY3Rpb25zLCB7IHRlc3Q6IHt9LCBuYW1lczogWyd0ZXN0J10gfSlcblxuICByZWZsb3cuaW5zdGFsbChzY29wZSlcblxuICB0Lm9rKFxuICAgIHNjb3BlLkludGVyYWN0YWJsZS5wcm90b3R5cGUucmVmbG93IGluc3RhbmNlb2YgRnVuY3Rpb24sXG4gICAgJ3JlZmxvdyBtZXRob2QgaXMgYWRkZWQgdG8gSW50ZXJhY3RhYmxlLnByb3RvdHlwZSdcbiAgKVxuXG4gIGNvbnN0IGZpcmVkID0gW11cbiAgY29uc3QgaW50ZXJhY3RhYmxlID0gc2NvcGUuaW50ZXJhY3RhYmxlcy5uZXcod2luLndpbmRvdylcbiAgY29uc3QgcmVjdCA9IE9iamVjdC5mcmVlemUoeyB0b3A6IDEwMCwgbGVmdDogMjAwLCBib3R0b206IDMwMCwgcmlnaHQ6IDQwMCB9KVxuXG4gIGludGVyYWN0YWJsZS5maXJlID0gKGlFdmVudCA9PiB7IGZpcmVkLnB1c2goaUV2ZW50KSB9KSBhcyBhbnlcbiAgKGludGVyYWN0YWJsZS50YXJnZXQgYXMgYW55KSA9IHt9XG4gIGludGVyYWN0YWJsZS5vcHRpb25zLnRlc3QgPSB7fVxuICBpbnRlcmFjdGFibGUucmVjdENoZWNrZXIoKCkgPT4gKHsgLi4ucmVjdCB9KSlcblxuICAvLyBtb2RpZnkgbW92ZSBjb29yZHNcbiAgc2NvcGUuaW50ZXJhY3Rpb25zLnNpZ25hbHMub24oJ2JlZm9yZS1hY3Rpb24tbW92ZScsICh7IGludGVyYWN0aW9uIH0pID0+IHtcbiAgICBpbnRlcmFjdGlvbi5jb29yZHMuY3VyLnBhZ2UgPSB7XG4gICAgICB4OiByZWN0LmxlZnQgKyAxMDAsXG4gICAgICB5OiByZWN0LnRvcCAtIDUwLFxuICAgIH1cbiAgfSlcblxuICBpbnRlcmFjdGFibGUucmVmbG93KHsgbmFtZTogJ3Rlc3QnIH0pXG5cbiAgY29uc3QgcGhhc2VzID0gWydyZWZsb3cnLCAnc3RhcnQnLCAnbW92ZScsICdlbmQnXVxuXG4gIGZvciAoY29uc3QgaW5kZXggaW4gcGhhc2VzKSB7XG4gICAgY29uc3QgcGhhc2UgPSBwaGFzZXNbaW5kZXhdXG4gICAgdC5lcXVhbChmaXJlZFtpbmRleF0udHlwZSwgYHRlc3Qke3BoYXNlfWAsIGBldmVudCAjJHtpbmRleH0gaXMgJHtwaGFzZX1gKVxuICB9XG5cbiAgY29uc3QgaW50ZXJhY3Rpb24gPSBmaXJlZFswXS5pbnRlcmFjdGlvblxuXG4gIHQuZGVlcEVxdWFsKFxuICAgIGludGVyYWN0aW9uLmNvb3Jkcy5zdGFydC5wYWdlLFxuICAgIHtcbiAgICAgIHg6IHJlY3QubGVmdCxcbiAgICAgIHk6IHJlY3QudG9wLFxuICAgIH0sXG4gICAgJ3VzZXMgZWxlbWVudCB0b3AgbGVmdCBmb3IgZXZlbnQgY29vcmRzJ1xuICApXG5cbiAgY29uc3QgcmVmbG93TW92ZSA9IGZpcmVkWzJdXG5cbiAgdC5kZWVwRXF1YWwoXG4gICAgcmVmbG93TW92ZS5kZWx0YSxcbiAgICB7IHg6IDEwMCwgeTogLTUwIH0sXG4gICAgJ21vdmUgZGVsdGEgaXMgY29ycmVjdCB3aXRoIG1vZGlmaWVkIGludGVyYWN0aW9uIGNvb3JkcydcbiAgKVxuXG4gIHQubm90T2soXG4gICAgaW50ZXJhY3Rpb24ucG9pbnRlcklzRG93bixcbiAgICAncmVmbG93IHBvaW50ZXIgd2FzIGxpZnRlZCdcbiAgKVxuXG4gIHQuZXF1YWwoXG4gICAgaW50ZXJhY3Rpb24ucG9pbnRlcnMubGVuZ3RoLFxuICAgIDAsXG4gICAgJ3JlZmxvdyBwb2ludGVyIHdhcyByZW1vdmVkIGZyb20gaW50ZXJhY3Rpb24nXG4gIClcblxuICB0Lm5vdE9rKFxuICAgIHNjb3BlLmludGVyYWN0aW9ucy5saXN0LmluY2x1ZGVzKGludGVyYWN0aW9uKSxcbiAgICAnaW50ZXJhY3Rpb24gaXMgcmVtb3ZlZCBmcm9tIGxpc3QnXG4gIClcblxuICB0LmVuZCgpXG59KVxuXG50ZXN0KCdhc3luYyByZWZsb3cnLCBhc3luYyB0ID0+IHtcbiAgY29uc3Qgc2NvcGUgPSBoZWxwZXJzLm1vY2tTY29wZSgpXG5cbiAgaW50ZXJhY3Rpb25zLmluc3RhbGwoc2NvcGUpXG5cbiAgT2JqZWN0LmFzc2lnbihzY29wZS5hY3Rpb25zLCB7IHRlc3Q6IHt9LCBuYW1lczogWyd0ZXN0J10gfSlcblxuICBsZXQgcmVmbG93RXZlbnRcbiAgbGV0IHByb21pc2VcblxuICBjb25zdCBpbnRlcmFjdGFibGUgPSBzY29wZS5pbnRlcmFjdGFibGVzLm5ldyh3aW4ud2luZG93KVxuICBjb25zdCByZWN0ID0gT2JqZWN0LmZyZWV6ZSh7IHRvcDogMTAwLCBsZWZ0OiAyMDAsIGJvdHRvbTogMzAwLCByaWdodDogNDAwIH0pXG4gIGludGVyYWN0YWJsZS5yZWN0Q2hlY2tlcigoKSA9PiAoeyAuLi5yZWN0IH0pKVxuICBpbnRlcmFjdGFibGUuZmlyZSA9IChpRXZlbnQgPT4geyByZWZsb3dFdmVudCA9IGlFdmVudCB9KSBhcyBhbnlcblxuICByZWZsb3cuaW5zdGFsbChzY29wZSlcblxuICBwcm9taXNlID0gaW50ZXJhY3RhYmxlLnJlZmxvdyh7IG5hbWU6ICd0ZXN0JyB9KVxuICB0Lm9rKHByb21pc2UgaW5zdGFuY2VvZiB3aW4ud2luZG93LlByb21pc2UsICdtZXRob2QgcmV0dXJucyBhIFByb21pc2UnKVxuICB0Lm5vdE9rKHJlZmxvd0V2ZW50LmludGVyYWN0aW9uLmludGVyYWN0aW5nKCksICdyZWZsb3cgbWF5IGVuZCBzeW5jaHJvbm91c2x5JylcblxuICB0LmVxdWFsKGF3YWl0IHByb21pc2UsIGludGVyYWN0YWJsZSwgJ3JldHVybmVkIFByb21pc2UgcmVzb2x2ZXMgdG8gaW50ZXJhY3RhYmxlJylcblxuICAvLyBibG9jayB0aGUgZW5kIG9mIHRoZSByZWZsb3cgaW50ZXJhY3Rpb24gYW5kIHN0b3AgaXQgYWZ0ZXIgYSB0aW1lb3V0XG4gIHNjb3BlLmludGVyYWN0aW9ucy5zaWduYWxzLm9uKCdiZWZvcmUtYWN0aW9uLWVuZCcsICh7IGludGVyYWN0aW9uIH0pID0+IHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IGludGVyYWN0aW9uLnN0b3AoKSwgMClcbiAgICByZXR1cm4gZmFsc2VcbiAgfSlcblxuICBwcm9taXNlID0gaW50ZXJhY3RhYmxlLnJlZmxvdyh7IG5hbWU6ICd0ZXN0JyB9KVxuXG4gIHQub2socmVmbG93RXZlbnQuaW50ZXJhY3Rpb24uaW50ZXJhY3RpbmcoKSwgJ2ludGVyYWN0aW9uIGNvbnRpbnVlcyBpZiBlbmQgaXMgYmxvY2tlZCcpXG4gIGF3YWl0IHByb21pc2VcbiAgdC5ub3RPayhyZWZsb3dFdmVudC5pbnRlcmFjdGlvbi5pbnRlcmFjdGluZygpLCAnaW50ZXJhY3Rpb24gaXMgc3RvcHBlZCBhZnRlciBwcm9taXNlIGlzIHJlc29sdmVkJylcblxuICB0LmVuZCgpXG59KVxuIl19